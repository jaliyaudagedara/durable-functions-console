@using DfxConsole.BlazorUI.Components.Shared

<div class="row">
    <div class="col-md-6 mb-3">
        <label class="form-label">Entity Name</label>
        <input type="text" class="form-control" @bind="_entityName" required />
    </div>
    <div class="col-md-6 mb-3">
        <div class="form-check mt-4 compact-checkboxes">
            <input class="form-check-input" type="checkbox" id="fetchState" @bind="_fetchState" />
            <label class="form-check-label" for="fetchState">Fetch State</label>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-3">
        <DateTimePicker Label="Last Operation Time From (Local)"
                        Value="@_lastOperationTimeFrom"
                        ValueChanged="@((DateTime? value) => _lastOperationTimeFrom = value)"
                        Placeholder="Select start date and time..." />
    </div>
    <div class="col-md-6 mb-3">
        <DateTimePicker Label="Last Operation Time To (Local)"
                        Value="@_lastOperationTimeTo"
                        ValueChanged="@((DateTime? value) => _lastOperationTimeTo = value)"
                        Placeholder="Select end date and time..." />
    </div>
</div>
<div class="mb-3">
    <label class="form-label">Top (Max Results)</label>
    <input type="number" class="form-control" @bind="_top" min="1" />
</div>
<button class="btn btn-primary" @onclick="Execute" disabled="@(!IsConfigValid)">Execute</button>

<style>
    .compact-checkboxes .form-check {
        padding-left: 1.25rem;
        margin-bottom: 0.25rem;
    }

    .compact-checkboxes .form-check-input {
        width: 1rem;
        height: 1rem;
        margin-top: 0.15rem;
    }

    .compact-checkboxes .form-check-label {
        font-size: 0.875rem;
        line-height: 1.3;
        padding-left: 0.25rem;
    }
</style>

@code {
    [Parameter, EditorRequired] public EventCallback<GetEntitiesParams> OnExecute { get; set; }
    [Parameter] public bool IsConfigValid { get; set; } = false;

    private string _entityName = string.Empty;
    private DateTime? _lastOperationTimeFrom;
    private DateTime? _lastOperationTimeTo;
    private bool _fetchState = false;
    private int? _top;

    private async Task Execute()
    {
        await OnExecute.InvokeAsync(new GetEntitiesParams(
            _entityName,
            _lastOperationTimeFrom,
            _lastOperationTimeTo,
            _fetchState,
            _top,
            null)); // Initial call with no continuation token
    }

    public record GetEntitiesParams(
        string EntityName,
        DateTime? LastOperationTimeFrom,
        DateTime? LastOperationTimeTo,
        bool FetchState,
        int? Top,
        string? ContinuationToken);
}